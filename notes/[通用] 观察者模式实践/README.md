# è§‚å¯Ÿè€…æ¨¡å¼å®è·µ

## ä»‹ç»

**æ¦‚å¿µ:**

1. å®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ã€‚
2. å½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚

åœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œç”±ä¸€ä¸ªç›®æ ‡ç‰©ä»¶ç®¡ç†æ‰€æœ‰ç›¸ä¾äºå®ƒçš„è§‚å¯Ÿè€…ç‰©ä»¶ï¼Œå¹¶ä¸”åœ¨å®ƒæœ¬èº«çš„çŠ¶æ€æ”¹å˜æ—¶ä¸»åŠ¨å‘å‡ºé€šçŸ¥ã€‚é€šçŸ¥å‘å¸ƒé€šå¸¸é€šè¿‡è°ƒç”¨å„è§‚å¯Ÿè€…æ‰€æä¾›çš„æ–¹æ³•æ¥å®ç°ã€‚

> æ‘˜è‡ªç™¾åº¦ç™¾ç§‘: [è§‚å¯Ÿè€…æ¨¡å¼](https://baike.baidu.com/item/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/5881786)

**ä½¿ç”¨åœºæ™¯:**

é€‚ç”¨äºâ€œä¸€å¯¹å¤šâ€çš„åº”ç”¨åœºæ™¯ï¼Œç”¨äºåº”å¯¹å„è§‚å¯Ÿè€…å¯¹è±¡é—´å¯èƒ½å­˜åœ¨çš„å¤æ‚å…³è”å…³ç³»ã€‚
ä¸ºäº†é¿å…ç»´æŠ¤å„è§‚å¯Ÿè€…é—´å¤æ‚çš„ä¾èµ–å…³ç³»ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé¡¶å±‚çš„ç®¡ç†è€…å­˜å‚¨å…¨å±€çš„çŠ¶æ€ï¼Œå¹¶åœ¨ç›¸åº”çŠ¶æ€å˜åŠ¨æ—¶ï¼Œé€šçŸ¥ä¾èµ–è¯¥çŠ¶æ€çš„è§‚å¯Ÿè€…å¯¹è±¡æ‰§è¡Œå®ƒçš„é€»è¾‘ã€‚

è¿™æ ·åšçš„å¥½å¤„åœ¨äº:

1. ä¸å†éœ€è¦å…³å¿ƒå„è§‚å¯Ÿè€…å¯¹è±¡é—´çš„ä¾èµ–å…³ç³»ï¼Œä¸éœ€è¦çŸ¥é“å…·ä½“æœ‰å¤šå°‘å¯¹è±¡è¦è¢«æ”¹å˜ã€‚
2. å„è§‚å¯Ÿè€…å¯¹è±¡é—´æ˜¯æ¾æ•£çš„ï¼Œæ·»åŠ æˆ–ç§»é™¤è§‚å¯Ÿè€…å¯¹è±¡ï¼Œå¯¹æ•´ä½“é€»è¾‘ä¸ä¼šäº§ç”Ÿè¾ƒå¤§çš„å½±å“ã€‚

**æ¨¡å¼è§’è‰²:**

åœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œéœ€è¦å®ç°ä¸¤å¤§è§’è‰²: ç®¡ç†è€…(Subject) å’Œ è§‚å¯Ÿè€…(Observer)ï¼Œå®ƒä»¬é€šå¸¸éœ€è¦åŒ…å«ä¸€äº›ç‰¹å®šçš„åŠŸèƒ½ã€‚

- Subject
  - ä½œä¸ºé¡¶å±‚å®¹å™¨å­˜å‚¨çŠ¶æ€ã€‚
  - å­˜å‚¨æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡(Observer)ã€‚
  - æä¾›å¯å¢åŠ å’Œåˆ é™¤è§‚å¯Ÿè€…å¯¹è±¡çš„æ¥å£ã€‚
  - åœ¨å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶ï¼Œç»™æ‰€æœ‰ç™»è®°è¿‡çš„è§‚å¯Ÿè€…å‘å‡ºé€šçŸ¥ã€‚

- Observer
  - è°ƒç”¨ Subject çš„æ³¨å†Œæ–¹æ³•ï¼Œå°†è‡ªèº«æ³¨å†Œä¸ºä¸€ä¸ª Observerã€‚
  - æä¾›ä¸€ä¸ªä¾›ç®¡ç†è€…é€šçŸ¥è‡ªèº«çš„æ–¹æ³•ã€‚

**è§‚å¯Ÿè€…æ¨¡å¼å®ç°æ€è·¯:**

éµå¾ª â€œæ³¨å†Œâ€”é€šçŸ¥â€”æ’¤é”€æ³¨å†Œâ€ çš„æµç¨‹ã€‚Observer å°†è‡ªå·±æ³¨å†Œåˆ° Subject çš„ç®¡ç†å®¹å™¨ Container ä¸­ã€‚Subject å‘ç”Ÿäº†æŸç§å˜åŒ–ï¼Œä»å®¹å™¨ä¸­å¾—åˆ°æ‰€æœ‰æ³¨å†Œè¿‡çš„ Observer å¹¶é€šçŸ¥å…¶å˜åŒ–ã€‚å½“è¦ Observer è¦æ³¨é”€æ—¶ï¼Œè°ƒç”¨ Subject ç›¸åº”çš„æ³¨é”€æ–¹æ³•ï¼ŒSubject å°†ä»å®¹å™¨ä¸­ç§»é™¤å¯¹åº”çš„ Observerã€‚

## ä»£ç æ ·ä¾‹

æ ¹æ®ä¸Šè¿°æ¦‚å¿µåŠå®ç°æ€è·¯ï¼Œæˆ‘ä»¬ç®€å•å®ç°ä¸€ä¸ªè§‚å¯Ÿè€…æ¨¡å¼ï¼Œè¯¥è§‚å¯Ÿè€…æ¨¡å¼ç¬¦åˆæœ€åŸºæœ¬çš„å‡ ä¸ªæ¡ä»¶:

1. æœ‰æ˜ç¡®çš„ Subject ç®¡ç†è€…å’Œ Observer è§‚å¯Ÿè€…åˆ’åˆ†ã€‚
2. Subject æä¾›æ³¨å†Œã€æ³¨é”€ä»¥åŠé€šçŸ¥è§‚å¯Ÿè€…çš„åŠŸèƒ½ã€‚
3. Subject ç»´æŠ¤æ³¨å†Œçš„è§‚å¯Ÿè€…åˆ—è¡¨åŠé¡¶å±‚çš„çŠ¶æ€ã€‚
4. Observer æä¾› Subject é€šçŸ¥è‡ªå·±çš„æ–¹æ³•(æ¥å£)ã€‚

CodeSandbox åœ°å€: [è§‚å¯Ÿè€…æ¨¡å¼](https://codesandbox.io/s/guan-cha-zhe-mo-shi-pctyw9)

**Subject å®ç°:**

```js
class Subject {
  constructor() {
    this.observers = []; // å­˜æ”¾è§‚å¯Ÿè€…
    this.state = {
      1: "å°çº¢",
      2: "å°æ˜",
      3: "å°å"
    }; // å­˜æ”¾çŠ¶æ€
  }

  // æ·»åŠ è§‚å¯Ÿè€…
  addObserver(observer) {
    this.observers.push(observer);
  }

  // ç§»é™¤è§‚å¯Ÿè€…
  removeObserver(observer) {
    this.observers = this.observers.filter((ob) => {
      return ob.id !== observer.id;
    });
  }

  // é€šçŸ¥è§‚å¯Ÿè€…: éå†æ³¨å†Œçš„è§‚å¯Ÿè€…æ‰€æä¾›çš„é€šçŸ¥æ¥å£(ä¾‹å¦‚ xx.update())
  notify() {
    this.observers.forEach((ob) => {
      ob.update(this.state[ob.id]);
    });
  }

  // è‹¥å…¨å±€ç®¡ç†äº† stateï¼Œåˆ™è¿˜å¯ä»¥ä¸º Observer æä¾›ç›¸åº”çš„ state æ›´æ”¹æ¥å£
  setState() {
    // ...
    this.notify()
  }
}

export default Subject;
```

**Observer å®ç°:**

```js
class Observer {
  constructor(id) {
    this.id = id;
  }

  // ğŸ‘‡ Subject é€šçŸ¥ Observer çš„æ–¹å¼
  update(name) {
    console.log(`${name}æ¥æ”¶åˆ°é€šçŸ¥!`);
  }
}

export default Observer;
```

**æµ‹è¯•:**

```js
import Observer from "./Observer";
import Subject from "./Subject";

// å®ä¾‹åŒ–
const subject = new Subject();
const ob1 = new Observer(1);
const ob2 = new Observer(2);
const ob3 = new Observer(3);

// æ·»åŠ è§‚å¯Ÿè€…ï¼Œå¹¶è§¦å‘é€šçŸ¥
subject.addObserver(ob1);
subject.addObserver(ob2);
subject.addObserver(ob3);
subject.notify();

console.log("------")

// ç§»é™¤æŸä¸ªè§‚å¯Ÿè€…ï¼Œå¹¶è§¦å‘é€šçŸ¥
subject.removeObserver(ob1);
subject.notify();

// ğŸ‘‡ æœ€ç»ˆè¿”å›ç»“æœ
// å°çº¢æ¥æ”¶åˆ°é€šçŸ¥! 
// å°æ˜æ¥æ”¶åˆ°é€šçŸ¥! 
// å°åæ¥æ”¶åˆ°é€šçŸ¥! 
// ------
// å°æ˜æ¥æ”¶åˆ°é€šçŸ¥! 
// å°åæ¥æ”¶åˆ°é€šçŸ¥!
```
