# package.jsoné…ç½®è§£æ

å‚è€ƒæ–‡ç« ï¼š

- [package.json é…ç½®å®Œå…¨è§£è¯»](https://juejin.cn/post/7145001740696289317)

## ç›®å½•

package.json å¸¸è§é…ç½®åˆ†ç±»ï¼š

- æè¿°é…ç½®
- æ–‡ä»¶é…ç½®
- è„šæœ¬é…ç½®
- ä¾èµ–é…ç½®
- å‘å¸ƒé…ç½®
- ç³»ç»Ÿé…ç½®
- ç¬¬ä¸‰æ–¹é…ç½®

package.json ä½œç”¨ï¼šå­˜å‚¨ä¸€åˆ‡ä¸é¡¹ç›®ç›¸å…³çš„é…ç½®ï¼Œä¾‹å¦‚é¡¹ç›®åŸºæœ¬ä¿¡æ¯ã€å¤–ç•Œè®¿é—®é¡¹ç›®çš„æ–¹å¼ã€é¡¹ç›®å†…ç½®è„šæœ¬ã€é¡¹ç›®ä¾èµ–ç­‰ã€‚

## æè¿°é…ç½®

ä¸»è¦æ˜¯é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬åç§°ï¼Œç‰ˆæœ¬ï¼Œæè¿°ï¼Œä»“åº“ï¼Œä½œè€…ç­‰ï¼Œéƒ¨åˆ†ä¼šå±•ç¤ºåœ¨ npm å®˜ç½‘ä¸Šã€‚

```json
{
  // ğŸ”¥é¡¹ç›®åç§° or npmåŒ…å
  "name": "react", 
  // ğŸ”¥ç‰ˆæœ¬å·ï¼Œå¼€æºé¡¹ç›®çš„ç‰ˆæœ¬å·é€šå¸¸éµå¾ª semver è¯­ä¹‰åŒ–è§„èŒƒ
  "version": "18.2.0", 
  // é¡¹ç›®çš„ä»“åº“åœ°å€åŠç‰ˆæœ¬æ§åˆ¶ä¿¡æ¯
  "repository": {
    "type": "git",
    "url": "https://github.com/facebook/react.git",
    "directory": "packages/react"
  }, 
  // é¡¹ç›®æè¿° (å±•ç¤ºäº npm å®˜ç½‘)
  "description":Â "ReactÂ isÂ aÂ JavaScriptÂ libraryÂ forÂ buildingÂ userÂ interfaces.", 
  // é¡¹ç›®æŠ€æœ¯å…³é”®è¯ (æé«˜ SEO)
  "keywords":Â [
    "ant",
    "component",
    "components",
    "design",
    "framework",
    "frontend",
    "react",
    "react-component",
    "ui"
  ], 
  // é¡¹ç›®çš„ä¸»é¡µé“¾æ¥ï¼Œé€šå¸¸æ˜¯é¡¹ç›® github é“¾æ¥ï¼Œé¡¹ç›®å®˜ç½‘æˆ–æ–‡æ¡£é¦–é¡µ
  "homepage":Â "https://reactjs.org/", 
  // é¡¹ç›® bug åé¦ˆåœ°å€ï¼Œé€šå¸¸æ˜¯ github issue é¡µé¢çš„é“¾æ¥
  "bugs":Â "https://github.com/vuejs/core/issues", 
  // ä½œè€…ä¿¡æ¯
  "author":Â "xxx", 
  // ğŸ”¥ç§æœ‰é¡¹ç›®, è‹¥ä¸º true åˆ™æ— æ³•å‘å¸ƒåˆ° npm å®˜ç½‘ä¸Š
  "private": true, 
}
```

## æ–‡ä»¶é…ç½®

åŒ…æ‹¬é¡¹ç›®æ‰€åŒ…å«çš„æ–‡ä»¶ï¼Œä»¥åŠå…¥å£ç­‰ä¿¡æ¯ã€‚

```js
{
  // ğŸ”¥filesæŒ‡å®šéœ€è¦è·Ÿéšä¸€èµ·å‘å¸ƒçš„å†…å®¹ï¼Œæ§åˆ¶ npm åŒ…çš„å¤§å°ã€‚
  // å‘å¸ƒæ—¶é»˜è®¤ä¼šåŒ…æ‹¬ package.jsonï¼Œlicenseï¼ŒREADME å’Œ mainÂ å­—æ®µé‡ŒæŒ‡å®šçš„æ–‡ä»¶ã€‚
  // å¿½ç•¥ node_modulesï¼Œlockfile ç­‰æ–‡ä»¶ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¯ä»¥æŒ‡å®šæ›´å¤šéœ€è¦ä¸€èµ·å‘å¸ƒçš„å†…å®¹ã€‚(å•ç‹¬çš„æ–‡ä»¶/æ•´ä¸ªæ–‡ä»¶å¤¹/ä½¿ç”¨é€šé…ç¬¦åŒ¹é…åˆ°çš„æ–‡ä»¶)
  // ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œfiles é‡Œä¼šæŒ‡å®šæ„å»ºå‡ºæ¥çš„äº§ç‰©ä»¥åŠç±»å‹æ–‡ä»¶ï¼Œè€Œ srcï¼Œtest ç­‰ç›®å½•ä¸‹çš„æ–‡ä»¶ä¸éœ€è¦è·Ÿéšå‘å¸ƒã€‚
  "files":Â [
    "filename.js",
    "directory/",
    "glob/*.{js,json}"
  ],
  // ğŸ”¥'module' => ç”¨ ESM è§£é‡Š .js æ–‡ä»¶(æ­¤æ—¶è®¿é—® CJS æ¨¡å—æ–‡ä»¶éœ€è¦ .cjs åç¼€)ï¼›åä¹‹åŒç†ã€‚
  "type":Â "module",
  // ğŸ”¥é¡¹ç›®å…¥å£æ–‡ä»¶ã€‚
  // è‹¥åŒæ—¶å­˜åœ¨ main å’Œ module å­—æ®µï¼Œmain å­—æ®µé»˜è®¤ä¸º CJS è§„èŒƒæ¨¡å—çš„é¡¹ç›®å…¥å£æ–‡ä»¶ã€‚
  "main":Â "./index.cjs",
  // ğŸ”¥webç«¯é¡¹ç›®å…¥å£æ–‡ä»¶è·¯å¾„ã€‚è¯¥è·¯å¾„ä¸‹æ–‡ä»¶ä¸å…è®¸åœ¨ server ç«¯ä½¿ç”¨ã€‚
  "browser":Â "./browser/index.js",
  // ğŸ”¥ESM è§„èŒƒæ¨¡å—çš„é¡¹ç›®å…¥å£æ–‡ä»¶ã€‚
  "module":Â "./index.js",
  // ğŸ”¥é…ç½®ä¸åŒç¯å¢ƒå¯¹åº”çš„æ¨¡å—å…¥å£æ–‡ä»¶(ä¼˜å…ˆçº§æœ€é«˜ > main)ã€‚
  // ä½œç”¨1: ä»¥åˆ«åå½¢å¼å°è£…åŒ…çš„å­è·¯å¾„ã€‚"import packageA/dist/css/index.css" => "import packageA/style"
  // ä½œç”¨2: ä»¥ '.' ä¸ºåˆ«åæ—¶ï¼Œè¡¨ç¤ºæ¨¡å—ä¸»å…¥å£ï¼Œå¯ä»¥çœ‹åšæ˜¯ "mian"/"module" ç­‰å­—æ®µåŠŸèƒ½çš„é›†åˆã€‚
  // ä½œç”¨3: è®¾ç½®æ¨¡å—è®¿é—®æƒé™ã€‚exports é™åˆ¶ä½¿ç”¨è€…ä¸å¯ä»¥è®¿é—®æœªåœ¨"exports"ä¸­å®šä¹‰çš„ä»»ä½•å…¶ä»–è·¯å¾„ã€‚
  // ä½œç”¨4: æä¾›äº†é¡¹ç›®(åŒ…)å¤šå…¥å£è®¿é—®çš„é€”å¾„ã€‚ä¾‹å¦‚ä¸‹é¢çš„ './docs' å’Œ './components'
  "exports":Â {
    ".": {
      "require":Â "./index.cjs",
      "import":Â "./index.js"
    },
    "./docs": {
      "require": "./docs/index.cjs",
      "import": "./docs/index.js"
    },
    "./components": {
      "require": "./components/index.cjs",
      "import": "./components/index.js"
    },
    "./style": "./dist/css/index.css'
  },
  // ğŸ”¥é¡¹ç›®çš„å·¥ä½œåŒºé…ç½®ï¼Œç”¨äºåœ¨æœ¬åœ°çš„æ ¹ç›®å½•ä¸‹ç®¡ç†å¤šä¸ªå­é¡¹ç›®ã€‚
  // å¯ä»¥è‡ªåŠ¨åœ°åœ¨ npm install æ—¶å°† workspaces ä¸‹é¢çš„åŒ…ï¼Œè½¯é“¾åˆ°æ ¹ç›®å½•çš„ node_modules ä¸­ï¼Œä¸ç”¨æ‰‹åŠ¨æ‰§è¡Œ npm link æ“ä½œã€‚
  // é€šå¸¸å­é¡¹ç›®éƒ½ä¼šå¹³é“ºç®¡ç†åœ¨ packages ç›®å½•ä¸‹ï¼Œ"packages/*" è¡¨ç¤ºå°†è¯¥è·¯å¾„ä¸‹æ‰€æœ‰å­é¡¹ç›®çš„ node_modules è½¯é“¾åˆ°æ ¹ç›®å½•ã€‚
  "workspaces": [
    "packages/*",
  ],
}
```

> å½“ä¸€ä¸ªé¡¹ç›®åŒæ—¶å®šä¹‰äº† mainï¼Œbrowser å’Œ moduleï¼Œåƒ webpackï¼Œrollup ç­‰æ„å»ºå·¥å…·ä¼šæ„ŸçŸ¥è¿™äº›å­—æ®µï¼Œå¹¶ä¼šæ ¹æ®ç¯å¢ƒä»¥åŠä¸åŒçš„æ¨¡å—è§„èŒƒæ¥è¿›è¡Œä¸åŒçš„å…¥å£æ–‡ä»¶æŸ¥æ‰¾ã€‚

### exports å­—æ®µè¯¦è§£

å‚è€ƒ [é˜®ä¸€å³°](https://es6.ruanyifeng.com/#docs/module-loader#package-json-%E7%9A%84-exports-%E5%AD%97%E6%AE%B5)

exports å­—æ®µçš„ä¼˜å…ˆçº§é«˜äº main / module ç­‰å…¥å£æ–‡ä»¶å­—æ®µã€‚å®ƒæœ‰å¤šç§ç”¨æ³•:

#### å­ç›®å½•åˆ«å

exports å­—æ®µå¯ä»¥æŒ‡å®šè„šæœ¬æˆ–å­ç›®å½•çš„åˆ«åï¼Œæ­¤æ—¶å®ƒçš„å‰ç¼€çš„å‚ç…§æ‹¼æ¥è·¯å¾„æ˜¯åŒ…åã€‚

```json
// ./node_modules/es-module-package/package.json
{
  "exports": {
    "./submodule": "./src/submodule.js"
  }
}
```

ä¸Šé¢çš„ä»£ç æŒ‡å®š src/submodule.js åˆ«åä¸º submodule ï¼Œç„¶åå°±å¯ä»¥ä»åˆ«ååŠ è½½è¿™ä¸ªæ–‡ä»¶ã€‚

```js
import submodule from 'es-module-package/submodule';
// åŠ è½½ ./node_modules/es-module-package/src/submodule.js
```

å¦‚æœæ²¡æœ‰æŒ‡å®šåˆ«åï¼Œå°±ä¸èƒ½ç”¨â€œæ¨¡å—+è„šæœ¬åâ€è¿™ç§å½¢å¼åŠ è½½è„šæœ¬ã€‚

```js
// æŠ¥é”™
import submodule from 'es-module-package/private-module.js';

// ä¸æŠ¥é”™
import submodule from './node_modules/es-module-package/private-module.js';
```

#### main çš„åˆ«å

exports å­—æ®µçš„åˆ«åå¦‚æœæ˜¯ `.`ï¼Œå°±ä»£è¡¨æ¨¡å—çš„ä¸»å…¥å£ï¼Œä¼˜å…ˆçº§é«˜äº main å­—æ®µï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥ç®€å†™æˆ exports å­—æ®µçš„å€¼ã€‚

```json
{
  "exports": {
    ".": "./main.js"
  }
}

// ç­‰åŒäº
{
  "exports": "./main.js"
}
```

ç”±äº exports å­—æ®µåªæœ‰æ”¯æŒ ES6 çš„ Node.js æ‰è®¤è¯†ï¼Œæ‰€ä»¥å¯ä»¥åŒæ—¶æ·»åŠ  main å­—æ®µæ¥å…¼å®¹æ—§ç‰ˆæœ¬çš„ Node.jsã€‚

```json
{
  "main": "./main-legacy.cjs",
  "exports": {
    ".": "./main-modern.cjs"
  }
}
```

> ä¸Šé¢ä»£ç ä¸­ï¼Œè€ç‰ˆæœ¬çš„ Node.js ï¼ˆä¸æ”¯æŒ ES6 æ¨¡å—ï¼‰çš„å…¥å£æ–‡ä»¶æ˜¯ main-legacy.cjs ï¼Œæ–°ç‰ˆæœ¬çš„ Node.js çš„å…¥å£æ–‡ä»¶æ˜¯ main-modern.cjsã€‚

#### æ¡ä»¶åŠ è½½

åˆ©ç”¨ `.` è¿™ä¸ªåˆ«åï¼Œå¯ä»¥ä¸º ES6 æ¨¡å—å’Œ CommonJS æŒ‡å®šä¸åŒçš„å…¥å£ã€‚

```js
{
  "type": "module",
  "exports": {
    ".": {
      "require": "./main.cjs",
      "default": "./main.js"
    }
  }
}
```

> ä¸Šé¢ä»£ç ä¸­ï¼Œåˆ«å`.`çš„`require`æ¡ä»¶æŒ‡å®š`require()`å‘½ä»¤çš„å…¥å£æ–‡ä»¶ï¼ˆå³ CommonJS çš„å…¥å£ï¼‰ï¼Œ`default`æ¡ä»¶æŒ‡å®šå…¶ä»–æƒ…å†µçš„å…¥å£ï¼Œæ­¤å¤„é…ç½®äº† `type: 'module'`ï¼Œå› æ­¤é»˜è®¤å‘½ä¸­ ESM æ¨¡å—è§„èŒƒã€‚

## è„šæœ¬é…ç½®

```json
{
  // npm run {scripts} / yarn {scripts} ç­‰å‘½ä»¤è¡Œæ–¹å¼å¯åŠ¨é¢„è®¾ç½®çš„è„šæœ¬
  "scripts": {
    "build": "webpack"
  },
  // è®¾ç½® scripts é‡Œçš„è„šæœ¬åœ¨è¿è¡Œæ—¶çš„å‚æ•°
  "config": {
    "port": "3001"
  },
}
```

## ä¾èµ–é…ç½®

é¡¹ç›®ä¾èµ–å…¶ä»–åŒ…å¼•ç”¨çš„ç›¸å…³ä¿¡æ¯ã€‚

```json
{
  // é¡¹ç›®ç”Ÿäº§ç¯å¢ƒ(è¿è¡Œæ—¶)ä¸‹éœ€è¦ç”¨åˆ°çš„ä¾èµ–
  // ä½¿ç”¨ npm install xxx æˆ–åˆ™ npm install xxx --save æ—¶ï¼Œä¼šè¢«è‡ªåŠ¨æ’å…¥åˆ°è¯¥å­—æ®µä¸­ã€‚
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  // é¡¹ç›®å¼€å‘ç¯å¢ƒéœ€è¦ç”¨åˆ°è€Œè¿è¡Œæ—¶ä¸éœ€è¦çš„ä¾èµ–ï¼Œç”¨äºè¾…åŠ©å¼€å‘
  // ä½¿ç”¨ npm install xxx -D æˆ–è€… npm install xxx --save-dev æ—¶ï¼Œä¼šè¢«è‡ªåŠ¨æ’å…¥åˆ°è¯¥å­—æ®µä¸­ã€‚
  "devDependencies": {
    "webpack": "^5.69.0"
  },
  // åŒä¼´ä¾èµ–
  "peerDependencies": {
    "react": ">=16.9.0",
    "react-dom": ">=16.9.0"
  }
}
```

### peerDependencies å­—æ®µè¯¦è§£

åŒä¼´ä¾èµ–ã€‚åœ¨è¯¥å­—æ®µä¸­å®šä¹‰çš„ç¬¬ä¸‰æ–¹åŒ…ï¼Œä¸ä¼šè¢«è‡ªåŠ¨å®‰è£…ï¼Œé€šå¸¸ç”¨äºè¡¨ç¤ºä¸å¦ä¸€ä¸ªåŒ…çš„ä¾èµ–ä¸å…¼å®¹æ€§å…³ç³»æ¥è­¦ç¤ºä½¿ç”¨è€…ã€‚
æ¯”å¦‚æˆ‘ä»¬å®‰è£… Aï¼ŒA çš„æ­£å¸¸ä½¿ç”¨ä¾èµ– B@2.x ç‰ˆæœ¬ï¼Œé‚£ä¹ˆ B@2.x å°±åº”è¯¥è¢«åˆ—åœ¨ A çš„ peerDependencies ä¸‹ï¼Œè¡¨ç¤ºâ€œå¦‚æœä½ ä½¿ç”¨æˆ‘ï¼Œé‚£ä¹ˆä½ ä¹Ÿéœ€è¦å®‰è£… Bï¼Œå¹¶ä¸”è‡³å°‘æ˜¯ 2.x ç‰ˆæœ¬â€ã€‚
æ¯”å¦‚ React ç»„ä»¶åº“ Ant Designï¼Œå®ƒçš„ package.json é‡Œ peerDependencies ä¸º

```json
"peerDependencies": {
  "react": ">=16.9.0",
  "react-dom": ">=16.9.0"
}
```

è¡¨ç¤ºå¦‚æœä½¿ç”¨ Ant Designï¼Œé‚£ä¹ˆä½ çš„é¡¹ç›®ä¹Ÿåº”è¯¥å®‰è£… react å’Œ react-domï¼Œå¹¶ä¸”ç‰ˆæœ¬éœ€è¦å¤§äºç­‰äº 16.9.0ã€‚

## ç¬¬ä¸‰æ–¹é…ç½®

ä¸€äº›ç¬¬ä¸‰æ–¹åº“æˆ–åº”ç”¨åœ¨è¿›è¡ŒæŸäº›å†…éƒ¨å¤„ç†æ—¶ä¼šä¾èµ–è¿™äº›å­—æ®µï¼Œå®‰è£…å¯¹åº”çš„ç¬¬ä¸‰æ–¹åº“åå¯ä»¥é€šè¿‡è¿™äº›å­—æ®µè¿›è¡Œé¢å¤–çš„é…ç½®ã€‚

```json
{
  // å…¶ä»–å·¥å…·è®¿é—®æœ¬é¡¹ç›® ts ç±»å‹å®šä¹‰æ—¶çš„å…¥å£æ–‡ä»¶
  "types": "./index.d.ts",
  // npm ä¸Šæ‰€æœ‰çš„æ–‡ä»¶éƒ½å¼€å¯ CDN æœåŠ¡
  "unpkg": "dist/vue.global.js",
  // è®¾ç½®é¡¹ç›®çš„æµè§ˆå™¨å…¼å®¹æƒ…å†µ, babel å’Œ autoprefixer ç­‰å·¥å…·ä¼šä½¿ç”¨è¯¥é…ç½®å¯¹ä»£ç è¿›è¡Œè½¬æ¢
  "browserslist": [
    "> 1%",
    "last 2 versions"
  ],
  // ç”¨äº webpack çš„ tree-shaking ä¼˜åŒ–, æŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶ä¸å‚ä¸ tree-shaking å¹¶å§‹ç»ˆä¿ç•™ã€‚
  "sideEffects": [
    "dist/*",
    "es/**/style/*",
    "lib/**/style/*",
    "*.less"
  ]
}
```
